<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <!-- ë·°í¬íŠ¸ ì„¤ì •: ëª¨ë°”ì¼ í™”ë©´ì—ì„œ ê¸°ê¸° í­ì— ë§ì¶° ë³´ì´ë„ë¡ í•¨ -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ìƒëŒ€ê°•ë„(RS) ê¸°ë°˜ ê°•ì„¸ ì¢…ëª© ë¶„ì„ ë¦¬í¬íŠ¸</title>
  <style>
    /* ì „ì²´ ì˜ì—­ ìŠ¤íƒ€ì¼ */
    body {
      font-family: Arial, sans-serif;
      margin: 0 auto;
      padding: 20px;
      /* í° í™”ë©´ì—ì„œëŠ” ìµœëŒ€ 1100pxê¹Œì§€, ì‘ì€ í™”ë©´ì—ì„œëŠ” 100% ê°€ê¹ê²Œ */
      max-width: 1100px;
    }

    /* ì œëª© ìŠ¤íƒ€ì¼ */
    h1 {
      text-align: center;
      font-size: 28px;
      font-weight: bold;
      margin-bottom: 10px;
    }

    /* ìƒë‹¨ ì»¨í…Œì´ë„ˆ(ì—…ë°ì´íŠ¸ ì‹œê°„ + ê²€ìƒ‰ì°½) */
    .top-container {
      display: flex;
      justify-content: space-between; /* ì¢Œìš°ë¡œ ë°°ì¹˜ */
      align-items: center;
      margin-bottom: 10px;
      gap: 10px; /* ìš”ì†Œ ì‚¬ì´ ê°„ê²© */
      flex-wrap: wrap; /* í™”ë©´ì´ ì¢ì„ ë•Œ ì¤„ë°”ê¿ˆ */
    }

    .update-time {
      font-size: 14px;
      font-weight: bold;
      color: #333;
    }

    /* ê²€ìƒ‰ì°½ ì»¨í…Œì´ë„ˆ */
    .search-container {
      display: flex;
      justify-content: flex-end;
      align-items: center;
      gap: 10px;
      margin-bottom: 15px;
    }

    /* ê²€ìƒ‰ì°½ ë° ë²„íŠ¼ */
    input {
      padding: 10px;
      font-size: 16px;
      border: 2px solid #ccc;
      border-radius: 5px;
      width: 200px;
    }

    button {
      padding: 10px 15px;
      font-size: 16px;
      background-color: #007bff;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      transition: 0.3s;
    }
    button:hover {
      background-color: #0056b3;
    }

    /* í…Œì´ë¸”ì„ ê°ì‹¸ëŠ” ë˜í¼: í™”ë©´ì´ ì‘ì„ ë•Œ ê°€ë¡œ ìŠ¤í¬ë¡¤ ê°€ëŠ¥í•˜ê²Œ */
    .table-wrapper {
      width: 100%;
      overflow-x: auto;  /* ê°€ë¡œ ìŠ¤í¬ë¡¤ í—ˆìš© */
      margin-top: 10px;
    }

    /* í…Œì´ë¸” ìŠ¤íƒ€ì¼ */
    table {
      width: 100%;
      border-collapse: collapse;
      min-width: 800px; /* í™”ë©´ì´ ì‘ì•„ë„ í…Œì´ë¸”ì´ ë„ˆë¬´ ì‘ì•„ì§€ì§€ ì•Šë„ë¡ ìµœì†Œ í­ ì„¤ì • */
    }

    th, td {
      border: 1px solid #ccc;
      padding: 12px 8px;
      text-align: center;
      white-space: nowrap;
    }

    th {
      background-color: #f2f2f2;
      font-weight: bold;
    }

    /* í˜ì´ì§€ë„¤ì´ì…˜ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
    .pagination {
      margin-top: 20px;
      text-align: center;
    }
    .pagination button {
      margin: 5px;
      padding: 10px 15px;
      font-size: 14px;
      cursor: pointer;
      border: 1px solid #ccc;
      background-color: white;
      color: black;
      transition: 0.3s;
      min-width: 40px; 
    }
    .pagination button:hover {
      background-color: #007bff;
      color: white;
    }
    .pagination button:disabled {
      background-color: #007bff;
      color: white;
      font-weight: bold;
      cursor: default;
    }

    /* í™”ë©´ì´ ì¢ì•„ì¡Œì„ ë•Œ(ê°€ë¡œí­ 768px ì´í•˜)ì— ëŒ€í•œ ë°˜ì‘í˜• ìŠ¤íƒ€ì¼ */
    @media (max-width: 768px) {
      body {
        padding: 10px;
      }

      h1 {
        font-size: 22px;
        margin-bottom: 15px;
      }

      .top-container {
        flex-direction: column; 
        align-items: flex-start;
      }

      .search-container {
        width: 100%;
        justify-content: space-between;
        margin-bottom: 10px;
      }

      /* ê²€ìƒ‰ì°½ í­ ì¤„ì´ê¸° */
      input {
        width: 100%;
        font-size: 14px;
      }

      /* ë²„íŠ¼ í¬ê¸° ì•½ê°„ ì¶•ì†Œ */
      button {
        padding: 8px 12px;
        font-size: 14px;
      }

      /* í…Œì´ë¸” ê¸€ì í¬ê¸°ì™€ íŒ¨ë”© ì¤„ì´ê¸° */
      th, td {
        padding: 8px 4px;
        font-size: 14px;
      }

      .pagination button {
        padding: 8px 12px;
        font-size: 12px;
      }

      /* í…Œì´ë¸” ìµœì†Œ í­ë„ ì¡°ê¸ˆ ì¤„ì„ */
      table {
        min-width: 600px;
      }
    }
  </style>
</head>
<body>
  <!-- ì œëª© -->
  <h1>ğŸ“Œ ìƒëŒ€ê°•ë„(RS) ê¸°ë°˜ ê°•ì„¸ ì¢…ëª© ë¶„ì„ ë¦¬í¬íŠ¸</h1>

  <div class="top-container">
    <div id="updateTime" class="update-time"></div>
    <div class="search-container">
      <input type="text" id="searchInput" placeholder="ğŸ” ì¢…ëª©ëª…ì„ ì…ë ¥í•˜ì„¸ìš”...">
      <button onclick="filterTable()">ê²€ìƒ‰</button>
    </div>
  </div>

  <!-- í…Œì´ë¸”ì„ ê°ì‹¸ëŠ” ë˜í¼ë¡œ ê°€ë¡œ ìŠ¤í¬ë¡¤ í—ˆìš© -->
  <div class="table-wrapper">
    <table id="stockTable">
      <thead>
        <tr>
          <th>ì¢…ëª©ì½”ë“œ</th>
          <th>ì´ë¦„</th>
          <th>ì¢…ê°€</th>
          <th>ìƒëŒ€ê°•ë„</th>
          <th>ìµœì €ê°€ ëŒ€ë¹„ ìƒìŠ¹ë¥ </th>
          <th>ìµœê³ ê°€ ëŒ€ë¹„ í•˜ë½ë¥ </th>
          <th>ì„¹í„°</th>
          <th>ì„¹í„° ìˆ˜ìµë¥  ìˆœìœ„</th>
          <th>ì‹œê°€ì´ì•¡</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <!-- í˜ì´ì§€ë„¤ì´ì…˜ ë²„íŠ¼ -->
  <div class="pagination" id="pagination"></div>

  <script>
    let allStocks = []; 
    let currentPage = 1;
    let totalPages = 1;
    const limit = 100;
    let filteredStocks = [];
    const API_URL = "https://backend-for-rs-production.up.railway.app/api/stocks"; 

    async function fetchAllStocks() {
      try {
        // ì´ˆê¸° ë¡œë”©ì‹œ ì „ì²´ ë°ì´í„°(ìµœëŒ€ 10,000ê°œ)ë¥¼ ê°€ì ¸ì™€ì„œ í•„í„° / í˜ì´ì§€ë„¤ì´ì…˜ í™œìš©
        // â€» ì‹¤ì œ ì„œë¹„ìŠ¤ì—ì„œëŠ” ì„œë²„ í˜ì´ì§•ì„ ì ê·¹ ê¶Œì¥
        const response = await fetch(`${API_URL}?page=1&limit=10000`);
        const data = await response.json();
        allStocks = data.stocks;
        totalPages = Math.ceil(allStocks.length / limit);
        filteredStocks = [...allStocks];

        updateTable(getCurrentPageData());
        updatePagination();
        getUpdateTime();
      } catch (error) {
        console.error("âŒ ë°ì´í„° ë¡œë“œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", error);
      }
    }

    function getUpdateTime() {
      const now = new Date();
      const hours = now.getHours();
      const minutes = now.getMinutes();

      let updateDate;
      // ì˜¤í›„ 3ì‹œ 30ë¶„ ì´í›„ë¼ë©´ ì˜¤ëŠ˜ ë‚ ì§œ, ê·¸ ì „ì´ë©´ ì–´ì œ ë‚ ì§œë¡œ í‘œì‹œ
      if (hours > 15 || (hours === 15 && minutes >= 30)) {
        updateDate = now;
      } else {
        updateDate = new Date();
        updateDate.setDate(updateDate.getDate() - 1);
      }

      const year = updateDate.getFullYear();
      const month = String(updateDate.getMonth() + 1).padStart(2, "0");
      const day = String(updateDate.getDate()).padStart(2, "0");

      document.getElementById("updateTime").innerHTML =
        `ğŸ“… ë°ì´í„° ê¸°ì¤€: ${year}.${month}.${day} ì˜¤í›„ 3:30`;
    }

    function getCurrentPageData() {
      const startIdx = (currentPage - 1) * limit;
      return filteredStocks.slice(startIdx, startIdx + limit);
    }

    function updateTable(stocks) {
      const tbody = document.querySelector("#stockTable tbody");
      let html = "";

      stocks.forEach(stock => {
        let increaseRate = `<span style="color: red;">${stock["lowest_increase_rate"]}</span>`;
        let decreaseRate = `<span style="color: blue;">${stock["highest_decrease_rate"]}</span>`;

        html += `<tr>
          <td>
            <a href="https://finance.naver.com/item/main.naver?code=${stock.ì¢…ëª©ì½”ë“œ}"
               target="_blank">${stock.ì¢…ëª©ì½”ë“œ}</a>
          </td>
          <td>${stock.ì´ë¦„}</td>
          <td>${stock.ì¢…ê°€}</td>
          <td>${Number(stock.relative_strength).toFixed(2)}</td>
          <td>${increaseRate}</td>
          <td>${decreaseRate}</td>
          <td>${stock.ì„¹í„°}</td>
          <td>${stock["ì„¹í„° ìˆ˜ìµë¥  ìˆœìœ„"]}</td>
          <td>${stock.ì‹œê°€ì´ì•¡}</td>
        </tr>`;
      });
      tbody.innerHTML = html;
    }

    function updatePagination() {
      const paginationDiv = document.getElementById("pagination");
      paginationDiv.innerHTML = "";

      paginationDiv.innerHTML += `
        <button onclick="changePage(${currentPage - 1})"
          ${currentPage === 1 ? "disabled" : ""}>ì´ì „</button>`;

      for (let i = 1; i <= totalPages; i++) {
        paginationDiv.innerHTML += `
          <button onclick="changePage(${i})"
            ${i === currentPage ? "disabled" : ""}>${i}</button>`;
      }

      paginationDiv.innerHTML += `
        <button onclick="changePage(${currentPage + 1})"
          ${currentPage === totalPages ? "disabled" : ""}>ë‹¤ìŒ</button>`;
    }

    function changePage(page) {
      if (page >= 1 && page <= totalPages) {
        currentPage = page;
        updateTable(getCurrentPageData());
        updatePagination();
        window.scrollTo({ top: 0, behavior: "smooth" });
      }
    }

    function filterTable() {
      const searchTerm = document.getElementById("searchInput").value.trim().toLowerCase();
      filteredStocks = allStocks.filter(stock => 
        stock.ì´ë¦„.toLowerCase().includes(searchTerm)
      );
      totalPages = Math.ceil(filteredStocks.length / limit);
      currentPage = 1;
      updateTable(getCurrentPageData());
      updatePagination();
    }

    document.getElementById("searchInput")
            .addEventListener("keypress", function(event) {
      if (event.key === "Enter") {
        filterTable();
      }
    });

    // í˜ì´ì§€ ë¡œë“œì‹œ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
    fetchAllStocks();
  </script>
</body>
</html>
