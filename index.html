<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <!-- ëª¨ë°”ì¼ ë°˜ì‘í˜•ì„ ìœ„í•œ ë·°í¬íŠ¸ ì„¤ì • -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ìƒëŒ€ê°•ë„(RS) ê¸°ë°˜ ê°•ì„¸ ì¢…ëª© ë¶„ì„ ë¦¬í¬íŠ¸</title>
  <style>
    /**********************************************
     * [1] ì „ì²´ ë ˆì´ì•„ì›ƒ & ë°˜ì‘í˜• ê¸°ë³¸ ì„¤ì •
     **********************************************/
    body {
      font-family: Arial, sans-serif;
      margin: 0 auto;
      padding: 20px;
      max-width: 1100px;
      box-sizing: border-box;
      position: relative;
    }
    * {
      box-sizing: inherit;
    }

    /**********************************************
     * [2] í—¤ë” (í–„ë²„ê±° ë©”ë‰´ + ì œëª©)
     **********************************************/
    .header {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 10px;
      position: relative;
    }
    .menu-icon {
      font-size: 24px;
      cursor: pointer;
    }
    h1 {
      flex: 1; /* ì œëª©ì´ ë‚¨ì€ ê³µê°„ ì°¨ì§€ */
      font-size: 28px;
      font-weight: bold;
      margin: 0;
      text-align: left; 
    }

    /**********************************************
     * [3] ì‚¬ì´ë“œë°” (ì¢Œì¸¡ ìŠ¬ë¼ì´ë“œ ë©”ë‰´)
     **********************************************/
    /* PC ê¸°ë³¸ í­ 400px */
    #sidebar {
      position: fixed;
      top: 0;
      left: -400px; /* ì²˜ìŒì—” í™”ë©´ ë°– */
      width: 400px;
      height: 100%;
      background-color: #f8f8f8;
      box-shadow: 2px 0 5px rgba(0, 0, 0, 0.3);
      transition: left 0.3s ease;
      z-index: 9998;
      display: flex;
      flex-direction: column;
    }
    #sidebar.open {
      left: 0; /* ì—´ë¦¬ë©´ í™”ë©´ ì•ˆìª½ */
    }
    /* ëª¨ë°”ì¼(â‰¤768px)ì—ì„œëŠ” í­ 280px */
    @media (max-width: 768px) {
      #sidebar {
        width: 280px;
        left: -280px;
      }
      #sidebar.open {
        left: 0;
      }
    }

    /* ì‚¬ì´ë“œë°” ìƒë‹¨ */
    .sidebar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1rem;
      font-weight: bold;
      border-bottom: 1px solid #ccc;
    }
    .close-btn {
      font-size: 20px;
      cursor: pointer;
    }
    /* ì‚¬ì´ë“œë°” ë©”ë‰´ ë¦¬ìŠ¤íŠ¸ */
    .sidebar-menu {
      list-style: none;
      padding: 0;
      margin: 0;
    }
    .sidebar-menu li {
      padding: 0.8rem 1rem;
      border-bottom: 1px solid #eee;
      cursor: pointer;
    }
    .sidebar-menu li:hover {
      background-color: #ddd;
    }
    /* ì‚¬ì´ë“œë°” ì•ˆìª½ ë‚´ìš© í‘œì‹œ ì˜ì—­ */
    .sidebar-content {
      flex: 1; 
      padding: 1rem;
      overflow-y: auto;
      font-size: 14px;
      line-height: 1.5;
    }

    /**********************************************
     * [4] ìƒë‹¨ ì»¨í…Œì´ë„ˆ (ì—…ë°ì´íŠ¸ ì‹œê°„ + ê²€ìƒ‰ì°½)
     **********************************************/
    .top-container {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px; 
      flex-wrap: wrap;
      gap: 10px;
    }
    .update-time {
      font-size: 14px;
      font-weight: bold;
      color: #333;
    }
    .search-container {
      display: flex;
      justify-content: flex-end;
      align-items: center;
      gap: 10px;
      margin-bottom: 15px;
    }
    input {
      padding: 10px;
      font-size: 16px;
      border: 2px solid #ccc;
      border-radius: 5px;
      width: 200px;
    }
    button {
      padding: 10px 15px;
      font-size: 16px;
      background-color: #007bff;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      transition: 0.3s;
    }
    button:hover {
      background-color: #0056b3;
    }

    /**********************************************
     * [5] í…Œì´ë¸” & í˜ì´ì§€ë„¤ì´ì…˜
     **********************************************/
    .table-wrapper {
      width: 100%;
      overflow-x: auto; 
      margin-top: 10px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      min-width: 800px;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 12px 8px;
      text-align: center;
      white-space: nowrap;
    }
    th {
      background-color: #f2f2f2;
      font-weight: bold;
    }
    .pagination {
      margin-top: 20px;
      text-align: center;
    }
    .pagination button {
      margin: 5px;
      padding: 10px 15px;
      font-size: 14px;
      cursor: pointer;
      border: 1px solid #ccc;
      background-color: white;
      color: black;
      transition: 0.3s;
      min-width: 40px;
    }
    .pagination button:hover {
      background-color: #007bff;
      color: white;
    }
    .pagination button:disabled {
      background-color: #007bff;
      color: white;
      font-weight: bold;
      cursor: default;
    }

    /**********************************************
     * [6] ë°˜ì‘í˜• (â‰¤768px)
     **********************************************/
    @media (max-width: 768px) {
      h1 {
        font-size: 22px;
      }
      .search-container {
        width: 100%;
        justify-content: space-between;
      }
      input {
        width: 100%;
        font-size: 14px;
      }
      button {
        padding: 8px 12px;
        font-size: 14px;
      }
      th, td {
        padding: 8px 4px;
        font-size: 14px;
      }
      table {
        min-width: 600px;
      }
      .pagination button {
        padding: 8px 12px;
        font-size: 12px;
      }
    }
  </style>
</head>
<body>

  <!-- [A] í—¤ë” (ë©”ë‰´ ì•„ì´ì½˜ + ì œëª©) -->
  <header class="header">
    <div class="menu-icon" onclick="toggleSidebar()">&#9776;</div>
    <h1>ğŸ“Š ìƒëŒ€ê°•ë„(RS) ê¸°ë°˜ ê°•ì„¸ ì¢…ëª© ë¶„ì„</h1>
  </header>

  <!-- [B] ìƒë‹¨ ì»¨í…Œì´ë„ˆ: ì—…ë°ì´íŠ¸ ì‹œê°„ & ê²€ìƒ‰ -->
  <div class="top-container">
    <div id="updateTime" class="update-time"></div>
    <div class="search-container">
      <input type="text" id="searchInput" placeholder="ğŸ” ì¢…ëª©ëª…ì„ ì…ë ¥í•˜ì„¸ìš”...">
      <button onclick="onSearch()">ê²€ìƒ‰</button>
    </div>
  </div>

  <!-- [C] í…Œì´ë¸” ì˜ì—­ -->
  <div class="table-wrapper">
    <table id="stockTable">
      <thead>
        <tr>
          <th>ì¢…ëª©ì½”ë“œ</th>
          <th>ì´ë¦„</th>
          <th>ì¢…ê°€</th>
          <th>ìƒëŒ€ê°•ë„</th>
          <th>ìµœì €ê°€ ëŒ€ë¹„ ìƒìŠ¹ë¥ </th>
          <th>ìµœê³ ê°€ ëŒ€ë¹„ í•˜ë½ë¥ </th>
          <th>ì„¹í„°</th>
          <th>ì„¹í„° ìˆ˜ìµë¥  ìˆœìœ„</th>
          <th>ì‹œê°€ì´ì•¡</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
  <div class="pagination" id="pagination"></div>

  <!-- [D] ì‚¬ì´ë“œë°” -->
  <div id="sidebar">
    <div class="sidebar-header">
      <span>ğŸ“‹ ë©”ë‰´</span>
      <span class="close-btn" onclick="toggleSidebar()">&times;</span>
    </div>
    <ul class="sidebar-menu">
      <li onclick="showRSContent()">ìƒëŒ€ê°•ë„(RS)ë€?</li>
      <li onclick="showDevIntro()">ì‚¬ì´íŠ¸ ê°œë°œì ì†Œê°œ</li>
    </ul>
    <div class="sidebar-content" id="sidebarContent">
      <!-- ë™ì ìœ¼ë¡œ í…ìŠ¤íŠ¸ í‘œì‹œ -->
    </div>
  </div>

  <script>
    /***********************************************
     * ì „ì—­ ë³€ìˆ˜ & ì´ˆê¸° ì„¤ì •
     ***********************************************/
    let currentPage = 1;
    let totalPages = 1;
    const limit = 100;  // í•œ í˜ì´ì§€ì— 100ê°œì”©
    let currentSearchTerm = ""; // ê²€ìƒ‰ì–´

    // ë°±ì—”ë“œ API ì£¼ì†Œ (page/limit/searchë¥¼ ì§€ì›)
    const BASE_URL = "https://backend-for-rs-production.up.railway.app/api/stocks";

    /***********************************************
     * [A] ì‚¬ì´ë“œë°” ì—´ê³  ë‹«ê¸°
     ***********************************************/
    function toggleSidebar() {
      const sidebar = document.getElementById("sidebar");
      const menuIcon = document.querySelector(".menu-icon");
      sidebar.classList.toggle("open");
      // ì—´ë ¸ìœ¼ë©´ í–„ë²„ê±° ì•„ì´ì½˜ ìˆ¨ê¸°ê³ , ë‹«ìœ¼ë©´ ë‹¤ì‹œ í‘œì‹œ
      if (sidebar.classList.contains("open")) {
        menuIcon.style.display = "none";
      } else {
        menuIcon.style.display = "block";
      }
    }

// [A-1] ì‚¬ì´ë“œë°” ë©”ë‰´ ë‚´ìš©
    const rsText = `
<h3>ìƒëŒ€ê°•ë„(RS)ë€?</h3>
<p><strong>ìƒëŒ€ê°•ë„(Relative Strength, RS)</strong>ëŠ” íŠ¹ì • ì£¼ì‹ì´ ì‹œì¥ ì „ì²´ ëŒ€ë¹„ ì–¼ë§ˆë‚˜ ê°•í•œ ìƒìŠ¹ì„¸ë¥¼ ë³´ì´ëŠ”ì§€ë¥¼ ì¸¡ì •í•˜ëŠ” ì§€í‘œì…ë‹ˆë‹¤.
ë‹¨ìˆœ ë“±ë½ë¥  ë¹„êµê°€ ì•„ë‹ˆë¼, ì¼ì • ê¸°ê°„ ì„±ê³¼ë¥¼ ì¢…í•©ì ìœ¼ë¡œ í‰ê°€í•˜ì—¬ ê°€ì¥ ê°•í•œ ì£¼ì‹ì„ ì°¾ì•„ë‚´ëŠ” ê²ƒì´ í•µì‹¬ì…ë‹ˆë‹¤.</p>
<h4>ğŸ“Œ ì£¼ìš” ê°œë…</h4>
<ul>
  <li>ìœŒë¦¬ì—„ ì˜¤ë‹(William O'Neil): CAN SLIMì—ì„œ <em>RS Rating</em> í™œìš©.</li>
  <li>ë§ˆí¬ ë¯¸ë„ˆë¹„ë‹ˆ(Mark Minervini): SEPA ì „ëµì—ì„œ <strong>"ê°•í•œ ì£¼ì‹ì´ ë” ê°•í•´ì§„ë‹¤"</strong> ì›ì¹™.</li>
</ul>
<p>âœ… ê°•í•œ ì¢…ëª©ì„ ì‚¬ì•¼ ë” ë†’ì€ ìˆ˜ìµì„ ê¸°ëŒ€í•  ìˆ˜ ìˆìŒ.<br/>
âœ… ì‹œì¥ ëŒ€ë¹„ ì–¼ë§ˆë‚˜ ê°•í•œ ìƒìŠ¹ì„¸ë¥¼ ë³´ì˜€ëŠ”ì§€ê°€ ì¤‘ìš”.<br/>
âœ… ê¸°ìˆ ì  ê°•ì„¸ë¥¼ ë³´ì´ëŠ” ì£¼ì‹ì´ ì¶”ì„¸ë¥¼ ì§€ì†í•  í™•ë¥ ì´ ë†’ìŒ.</p>

<h4>ìƒëŒ€ê°•ë„(RS) ê³„ì‚° ë°©ë²•</h4>
<p>ëŒ€í‘œì ìœ¼ë¡œ ìœŒë¦¬ì—„ ì˜¤ë‹ì˜ <strong>RS Rating</strong> ê³„ì‚°ë²•ê³¼ 
ë§ˆí¬ ë¯¸ë„ˆë¹„ë‹ˆì˜ <strong>ìƒëŒ€ê°•ë„ ì ìˆ˜</strong> ë°©ì‹ì´ ìˆìŒ.</p>
<h5>âœ… 1. ìœŒë¦¬ì—„ ì˜¤ë‹ì˜ RS Rating</h5>
<p>ìµœê·¼ 12ê°œì›” ì£¼ê°€ ìƒìŠ¹ë¥ ì„ ì „ì²´ ì¢…ëª©ê³¼ ë¹„êµí•´ 
í¼ì„¼íƒ€ì¼(1~99)ë¡œ í™˜ì‚°.<br/>
RS Rating 90 â†’ ì‹œì¥ 90%ì˜ ì£¼ì‹ë³´ë‹¤ ê°•í•¨.</p>
<h5>âœ… 2. ë§ˆí¬ ë¯¸ë„ˆë¹„ë‹ˆì˜ ìƒëŒ€ê°•ë„ ì ìˆ˜</h5>
<p><code>RS = (2ì£¼ ìˆ˜ìµë¥ Ã—2) + 1ê°œì›” + 3ê°œì›” + 6ê°œì›” ìˆ˜ìµë¥ </code><br/>
ë‹¨ê¸° ëª¨ë©˜í…€(2ì£¼)ì— ê°€ì¤‘, ì¥ê¸°(6ê°œì›”)ë„ ë°˜ì˜ â†’ ì¢…í•©ì  í‰ê°€.</p>
`;

    const devIntro = `
<h3>ğŸ“š í•œì–‘ëŒ€ìƒì˜ ê²½ì œ & ì£¼ì‹ ìŠ¤í„°ë”” ë¸”ë¡œê·¸</h3>
<p>ì•ˆë…•í•˜ì„¸ìš”! ì €ëŠ” í•œì–‘ëŒ€í•™êµ ê²½ì œê¸ˆìœµí•™ê³¼ & ì†Œí”„íŠ¸ì›¨ì–´ìœµí•© ì „ê³µìƒì…ë‹ˆë‹¤.
ë„¤ì´ë²„ ë¸”ë¡œê·¸(<em>jangsdaytrading</em>)ë¥¼ ìš´ì˜í•˜ë©°, ê³µë¶€ ê³¼ì •ì„ ê¸°ë¡í•˜ê³  ìˆìŠµë‹ˆë‹¤.</p>
<h4>ğŸ’¡ ì£¼ì‹ ê³µë¶€ & íŠ¸ë ˆì´ë”© ìŠ¤í„°ë””</h4>
<ul>
  <li>ìœŒë¦¬ì—„ ì˜¤ë‹ì˜ CAN SLIM, ëŒíŒŒë§¤ë§¤ ê¸°ë²• ì—°êµ¬</li>
  <li>ìƒëŒ€ê°•ë„(RS) ì§€í‘œ í™œìš©</li>
  <li>ê¸°ìˆ ì  ë¶„ì„ + ê²½ì œ íë¦„ + ë§¤ë§¤ íŒ¨í„´ ì—°êµ¬</li>
</ul>
<p>ê²½ì œ ì´ìŠˆ ë¶„ì„ & íˆ¬ì ì•„ì´ë””ì–´ ê³µìœ  ë“± ê¾¸ì¤€íˆ í¬ìŠ¤íŒ… ì¤‘ì…ë‹ˆë‹¤.</p>
<h4>ğŸ“Œ ë„¤ì´ë²„ ë¸”ë¡œê·¸: <em>jangsdaytrading</em></h4>
<p>í•¨ê»˜ ê³µë¶€í•˜ë©° ì„±ì¥í•´ ë‚˜ê°€ê¸¸ ë°”ëë‹ˆë‹¤!</p>
`;

    function showRSContent() {
      document.getElementById("sidebarContent").innerHTML = rsText;
    }
    function showDevIntro() {
      document.getElementById("sidebarContent").innerHTML = devIntro;
    }

    /***********************************************
     * [B] í˜ì´ì§€ ë¡œë“œì‹œ ì´ˆê¸° ë°ì´í„° ìš”ì²­ + ë‚ ì§œ í‘œì‹œ
     ***********************************************/
    window.onload = () => {
      fetchStocks(1, currentSearchTerm);
      getUpdateTime();
    };

    function getUpdateTime() {
      const now = new Date();
      const hours = now.getHours();
      const minutes = now.getMinutes();

      let updateDate;
      if (hours > 15 || (hours === 15 && minutes >= 30)) {
        updateDate = now;
      } else {
        updateDate = new Date();
        updateDate.setDate(updateDate.getDate() - 1);
      }

      const year = updateDate.getFullYear();
      const month = String(updateDate.getMonth() + 1).padStart(2, "0");
      const day = String(updateDate.getDate()).padStart(2, "0");
      document.getElementById("updateTime").innerHTML =
        `ğŸ“… ë°ì´í„° ê¸°ì¤€: ${year}.${month}.${day} ì˜¤í›„ 3:30`;
    }

    /***********************************************
     * [C] ì„œë²„ì— (page, limit, search) ìš”ì²­
     ***********************************************/
    async function fetchStocks(page, searchTerm) {
      try {
        let url = `${BASE_URL}?page=${page}&limit=${limit}`;
        if (searchTerm) {
          url += `&search=${encodeURIComponent(searchTerm)}`;
        }
        const res = await fetch(url);
        const data = await res.json();

        // data: { stocks, total_pages, current_page }
        const stocks = data.stocks;
        totalPages = data.total_pages;
        currentPage = data.current_page;

        updateTable(stocks);
        updatePagination();
      } catch (error) {
        console.error("âŒ ë°ì´í„° ë¡œë“œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", error);
      }
    }

    /***********************************************
     * [D] í…Œì´ë¸” ìƒì„±
     ***********************************************/
    function updateTable(stocks) {
      const tbody = document.querySelector("#stockTable tbody");
      let html = "";

      stocks.forEach(stock => {
        // ë°±ì—”ë“œì—ì„œ + / -ê°€ í¬í•¨ëœ ë¬¸ìì—´ì„ ì£¼ë¯€ë¡œ, ê·¸ëŒ€ë¡œ ì¶œë ¥
        let increaseRate = `<span style="color: red;">${stock["lowest_increase_rate"]}</span>`;
        let decreaseRate = `<span style="color: blue;">${stock["highest_decrease_rate"]}</span>`;

        html += `<tr>
          <td><a href="https://finance.naver.com/item/main.naver?code=${stock.ì¢…ëª©ì½”ë“œ}" target="_blank">
            ${stock.ì¢…ëª©ì½”ë“œ}
          </a></td>
          <td>${stock.ì´ë¦„}</td>
          <td>${stock.ì¢…ê°€}</td>
          <td>${Number(stock.relative_strength).toFixed(2)}</td>
          <td>${increaseRate}</td>
          <td>${decreaseRate}</td>
          <td>${stock.ì„¹í„°}</td>
          <td>${stock["ì„¹í„° ìˆ˜ìµë¥  ìˆœìœ„"]}</td>
          <td>${stock.ì‹œê°€ì´ì•¡}</td>
        </tr>`;
      });

      tbody.innerHTML = html;
    }

    /***********************************************
     * [E] í˜ì´ì§€ë„¤ì´ì…˜ ë²„íŠ¼
     ***********************************************/
    function updatePagination() {
      const paginationDiv = document.getElementById("pagination");
      paginationDiv.innerHTML = "";

      // ì´ì „ í˜ì´ì§€
      paginationDiv.innerHTML += `
        <button onclick="changePage(${currentPage - 1})"
          ${currentPage === 1 ? "disabled" : ""}>
          ì´ì „
        </button>`;

      // í˜ì´ì§€ ë²ˆí˜¸ ë²„íŠ¼
      for (let i = 1; i <= totalPages; i++) {
        paginationDiv.innerHTML += `
          <button onclick="changePage(${i})"
            ${i === currentPage ? "disabled" : ""}>
            ${i}
          </button>`;
      }

      // ë‹¤ìŒ í˜ì´ì§€
      paginationDiv.innerHTML += `
        <button onclick="changePage(${currentPage + 1})"
          ${currentPage === totalPages ? "disabled" : ""}>
          ë‹¤ìŒ
        </button>`;
    }

    function changePage(page) {
      if (page >= 1 && page <= totalPages) {
        fetchStocks(page, currentSearchTerm);
        window.scrollTo({ top: 0, behavior: "smooth" });
      }
    }

    /***********************************************
     * [F] ê²€ìƒ‰ ê¸°ëŠ¥ (ì„œë²„ ì‚¬ì´ë“œ ê²€ìƒ‰)
     ***********************************************/
    function onSearch() {
      const term = document.getElementById("searchInput").value.trim().toLowerCase();
      currentSearchTerm = term;
      fetchStocks(1, currentSearchTerm);
    }
    document.getElementById("searchInput").addEventListener("keypress", function(e) {
      if (e.key === "Enter") {
        onSearch();
      }
    });
  </script>
</body>
</html>

