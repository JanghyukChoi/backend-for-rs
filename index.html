<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>상대강도(RS) 기반 강세 종목 분석 리포트</title>
    <style>
        /* ✅ 전체 페이지 스타일 */
        body {
            font-family: Arial, sans-serif;
            margin: 40px auto;
            padding: 20px;
            max-width: 1100px;
        }

        /* ✅ 제목 스타일 */
        h1 {
            text-align: center;
            font-size: 28px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        /* ✅ 업데이트 시간 & 검색창을 같은 줄에 배치 */
        .top-container {
            display: flex;
            justify-content: space-between; /* ✅ 좌우 정렬 */
            align-items: center;
            margin-bottom: 10px; /* ✅ 표와의 간격 최소화 */
        }

        /* ✅ 데이터 기준 날짜 스타일 */
        .update-time {
            font-size: 14px;
            font-weight: bold;
            color: #333;
        }

        /* ✅ 검색창 컨테이너 (우측 정렬) */
        .search-container {
            display: flex;
            justify-content: flex-end;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }



        /* ✅ 검색 입력창 */
        input {
            padding: 10px;
            font-size: 16px;
            border: 2px solid #ccc;
            border-radius: 5px;
            width: 200px;
        }

        /* ✅ 검색 버튼 */
        button {
            padding: 10px 15px;
            font-size: 16px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: 0.3s;
        }

        button:hover {
            background-color: #0056b3;
        }

        /* ✅ 테이블 스타일 */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }

        th, td {
            border: 1px solid black;
            padding: 12px 8px;
            text-align: center;
            white-space: nowrap;
        }

        th {
            background-color: #f2f2f2;
            font-weight: bold;
        }

        /* ✅ 페이지네이션 버튼 스타일 */
        .pagination {
            margin-top: 20px;
            text-align: center;
        }

        .pagination button {
            margin: 5px;
            padding: 10px 15px;
            font-size: 14px;
            cursor: pointer;
            border: 1px solid #ccc;
            background-color: white;
            color: black;  /* ✅ 숫자가 항상 보이도록 설정 */
            transition: 0.3s;
            min-width: 40px;  /* ✅ 버튼 크기 균일하게 설정 */
        }

        /* ✅ 선택된 페이지 버튼 */
        .pagination button:disabled {
            background-color: #007bff;
            color: white;
            font-weight: bold;
        }

        /* ✅ 버튼 hover 효과 */
        .pagination button:hover {
            background-color: #007bff;
            color: white;
        }
    </style>
</head>
<body>
    <!-- ✅ 제목 변경 -->
    <h1>📌 상대강도(RS) 기반 강세 종목 분석 리포트</h1>

    <div class="top-container">
        <div id="updateTime" class="update-time"></div>
        <div class="search-container">
            <input type="text" id="searchInput" placeholder="🔍 종목명을 입력하세요...">
            <button onclick="filterTable()">검색</button>
        </div>
    </div>

    <table id="stockTable">
        <thead>
            <tr>
                <th>종목코드</th>
                <th>이름</th>
                <th>종가</th>
                <th>상대강도</th>
                <th>최저가 대비 상승률</th>
                <th>최고가 대비 하락률</th>
                <th>섹터</th>
                <th>섹터 수익률 순위</th>
                <th>시가총액</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

    <!-- ✅ 페이지네이션 버튼 -->
    <div class="pagination" id="pagination"></div>

    <script>
        let allStocks = []; 
        let currentPage = 1;
        let totalPages = 1;
        const limit = 100;
        let filteredStocks = [];
        const API_URL = "https://backend-for-rs-production.up.railway.app/api/stocks"; 

        async function fetchAllStocks() {
            try {
                const response = await fetch(`${API_URL}?page=1&limit=10000`);
                const data = await response.json();
                allStocks = data.stocks;
                totalPages = Math.ceil(allStocks.length / limit);
                filteredStocks = [...allStocks]; 
                updateTable(getCurrentPageData());
                updatePagination();
                getUpdateTime();

            } catch (error) {
                console.error("❌ 데이터 로드 중 오류 발생:", error);
            }
        }

        function getUpdateTime() {
            const now = new Date();
            const hours = now.getHours();
            const minutes = now.getMinutes();

            let updateDate;
            if (hours > 15 || (hours === 15 && minutes >= 30)) {
                updateDate = now;
            } else {
                updateDate = new Date();
                updateDate.setDate(updateDate.getDate() - 1);
            }

            const year = updateDate.getFullYear();
            const month = String(updateDate.getMonth() + 1).padStart(2, "0");
            const day = String(updateDate.getDate()).padStart(2, "0");

            document.getElementById("updateTime").innerHTML = `📅 데이터 기준: ${year}.${month}.${day} 오후 3:30`;
        }

        function getCurrentPageData() {
            const startIdx = (currentPage - 1) * limit;
            return filteredStocks.slice(startIdx, startIdx + limit);
        }

        function updateTable(stocks) {
            const tbody = document.querySelector("#stockTable tbody");
            let html = "";
            stocks.forEach(stock => {
                let increaseRate = `<span style="color: red;">+${stock["lowest_increase_rate"]}</span>`;
                let decreaseRate = `<span style="color: blue;">-${stock["highest_decrease_rate"]}</span>`;

                html += `<tr>
                    <td><a href="https://finance.naver.com/item/main.naver?code=${stock.종목코드}" target="_blank">${stock.종목코드}</a></td>
                    <td>${stock.이름}</td>
                    <td>${stock.종가}</td>
                    <td>${stock.relative_strength.toFixed(2)}</td>
                    <td>${increaseRate}</td>
                    <td>${decreaseRate}</td>
                    <td>${stock.섹터}</td>
                    <td>${stock["섹터 수익률 순위"]}</td>
                    <td>${stock.시가총액}</td>
                </tr>`;
            });
            tbody.innerHTML = html;
        }

        function updatePagination() {
            const paginationDiv = document.getElementById("pagination");
            paginationDiv.innerHTML = "";

            paginationDiv.innerHTML += `<button onclick="changePage(${currentPage - 1})" ${currentPage === 1 ? "disabled" : ""}>이전</button>`;

            for (let i = 1; i <= totalPages; i++) {
                paginationDiv.innerHTML += `<button onclick="changePage(${i})" ${i === currentPage ? "disabled" : ""}>${i}</button>`;
            }

            paginationDiv.innerHTML += `<button onclick="changePage(${currentPage + 1})" ${currentPage === totalPages ? "disabled" : ""}>다음</button>`;
        }

        function changePage(page) {
            if (page >= 1 && page <= totalPages) {
                currentPage = page;
                updateTable(getCurrentPageData());
                updatePagination();
                window.scrollTo({ top: 0, behavior: "smooth" });
            }
        }

        function filterTable() {
            const searchTerm = document.getElementById("searchInput").value.trim().toLowerCase();
            filteredStocks = allStocks.filter(stock => stock.이름.toLowerCase().includes(searchTerm));
            totalPages = Math.ceil(filteredStocks.length / limit);
            currentPage = 1;
            updateTable(getCurrentPageData());
            updatePagination();
        }

        document.getElementById("searchInput").addEventListener("keypress", function(event) {
            if (event.key === "Enter") {
                filterTable();
            }
        });
        fetchAllStocks();
    </script>

</body>
</html>
