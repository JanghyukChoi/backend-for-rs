<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìƒëŒ€ê°•ë„(RS) ê¸°ë°˜ ê°•ì„¸ ì¢…ëª© ë¶„ì„ ë¦¬í¬íŠ¸</title>
    <style>
        /* âœ… ì „ì²´ í˜ì´ì§€ ìŠ¤íƒ€ì¼ */
        body {
            font-family: Arial, sans-serif;
            margin: 40px auto;
            padding: 20px;
            max-width: 1100px;
        }

        /* âœ… ì œëª© ìŠ¤íƒ€ì¼ */
        h1 {
            text-align: center;
            font-size: 28px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        /* âœ… ì—…ë°ì´íŠ¸ ì‹œê°„ & ê²€ìƒ‰ì°½ì„ ê°™ì€ ì¤„ì— ë°°ì¹˜ */
        .top-container {
            display: flex;
            justify-content: space-between; /* âœ… ì¢Œìš° ì •ë ¬ */
            align-items: center;
            margin-bottom: 10px; /* âœ… í‘œì™€ì˜ ê°„ê²© ìµœì†Œí™” */
        }

        /* âœ… ë°ì´í„° ê¸°ì¤€ ë‚ ì§œ ìŠ¤íƒ€ì¼ */
        .update-time {
            font-size: 14px;
            font-weight: bold;
            color: #333;
        }

        /* âœ… ê²€ìƒ‰ì°½ ì»¨í…Œì´ë„ˆ (ìš°ì¸¡ ì •ë ¬) */
        .search-container {
            display: flex;
            justify-content: flex-end;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }



        /* âœ… ê²€ìƒ‰ ì…ë ¥ì°½ */
        input {
            padding: 10px;
            font-size: 16px;
            border: 2px solid #ccc;
            border-radius: 5px;
            width: 200px;
        }

        /* âœ… ê²€ìƒ‰ ë²„íŠ¼ */
        button {
            padding: 10px 15px;
            font-size: 16px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: 0.3s;
        }

        button:hover {
            background-color: #0056b3;
        }

        /* âœ… í…Œì´ë¸” ìŠ¤íƒ€ì¼ */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }

        th, td {
            border: 1px solid black;
            padding: 12px 8px;
            text-align: center;
            white-space: nowrap;
        }

        th {
            background-color: #f2f2f2;
            font-weight: bold;
        }

        /* âœ… í˜ì´ì§€ë„¤ì´ì…˜ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .pagination {
            margin-top: 20px;
            text-align: center;
        }

        .pagination button {
            margin: 5px;
            padding: 10px 15px;
            font-size: 14px;
            cursor: pointer;
            border: 1px solid #ccc;
            background-color: white;
            color: black;  /* âœ… ìˆ«ìê°€ í•­ìƒ ë³´ì´ë„ë¡ ì„¤ì • */
            transition: 0.3s;
            min-width: 40px;  /* âœ… ë²„íŠ¼ í¬ê¸° ê· ì¼í•˜ê²Œ ì„¤ì • */
        }

        /* âœ… ì„ íƒëœ í˜ì´ì§€ ë²„íŠ¼ */
        .pagination button:disabled {
            background-color: #007bff;
            color: white;
            font-weight: bold;
        }

        /* âœ… ë²„íŠ¼ hover íš¨ê³¼ */
        .pagination button:hover {
            background-color: #007bff;
            color: white;
        }
    </style>
</head>
<body>
    <!-- âœ… ì œëª© ë³€ê²½ -->
    <h1>ğŸ“Œ ìƒëŒ€ê°•ë„(RS) ê¸°ë°˜ ê°•ì„¸ ì¢…ëª© ë¶„ì„ ë¦¬í¬íŠ¸</h1>

    <div class="top-container">
        <div id="updateTime" class="update-time"></div>
        <div class="search-container">
            <input type="text" id="searchInput" placeholder="ğŸ” ì¢…ëª©ëª…ì„ ì…ë ¥í•˜ì„¸ìš”...">
            <button onclick="filterTable()">ê²€ìƒ‰</button>
        </div>
    </div>

    <table id="stockTable">
        <thead>
            <tr>
                <th>ì¢…ëª©ì½”ë“œ</th>
                <th>ì´ë¦„</th>
                <th>ì¢…ê°€</th>
                <th>ìƒëŒ€ê°•ë„</th>
                <th>ìµœì €ê°€ ëŒ€ë¹„ ìƒìŠ¹ë¥ </th>
                <th>ìµœê³ ê°€ ëŒ€ë¹„ í•˜ë½ë¥ </th>
                <th>ì„¹í„°</th>
                <th>ì„¹í„° ìˆ˜ìµë¥  ìˆœìœ„</th>
                <th>ì‹œê°€ì´ì•¡</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

    <!-- âœ… í˜ì´ì§€ë„¤ì´ì…˜ ë²„íŠ¼ -->
    <div class="pagination" id="pagination"></div>

    <script>
        let allStocks = []; 
        let currentPage = 1;
        let totalPages = 1;
        const limit = 100;
        let filteredStocks = [];
        const API_URL = "https://backend-for-rs-production.up.railway.app/api/stocks"; 

        async function fetchAllStocks() {
            try {
                const response = await fetch(`${API_URL}?page=1&limit=10000`);
                const data = await response.json();
                allStocks = data.stocks;
                totalPages = Math.ceil(allStocks.length / limit);
                filteredStocks = [...allStocks]; 
                updateTable(getCurrentPageData());
                updatePagination();
                getUpdateTime();

            } catch (error) {
                console.error("âŒ ë°ì´í„° ë¡œë“œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", error);
            }
        }

        function getUpdateTime() {
            const now = new Date();
            const hours = now.getHours();
            const minutes = now.getMinutes();

            let updateDate;
            if (hours > 15 || (hours === 15 && minutes >= 30)) {
                updateDate = now;
            } else {
                updateDate = new Date();
                updateDate.setDate(updateDate.getDate() - 1);
            }

            const year = updateDate.getFullYear();
            const month = String(updateDate.getMonth() + 1).padStart(2, "0");
            const day = String(updateDate.getDate()).padStart(2, "0");

            document.getElementById("updateTime").innerHTML = `ğŸ“… ë°ì´í„° ê¸°ì¤€: ${year}.${month}.${day} ì˜¤í›„ 3:30`;
        }

        function getCurrentPageData() {
            const startIdx = (currentPage - 1) * limit;
            return filteredStocks.slice(startIdx, startIdx + limit);
        }

        function updateTable(stocks) {
            const tbody = document.querySelector("#stockTable tbody");
            let html = "";
            stocks.forEach(stock => {
                let increaseRate = `<span style="color: red;">+${stock["lowest_increase_rate"]}</span>`;
                let decreaseRate = `<span style="color: blue;">-${stock["highest_decrease_rate"]}</span>`;

                html += `<tr>
                    <td><a href="https://finance.naver.com/item/main.naver?code=${stock.ì¢…ëª©ì½”ë“œ}" target="_blank">${stock.ì¢…ëª©ì½”ë“œ}</a></td>
                    <td>${stock.ì´ë¦„}</td>
                    <td>${stock.ì¢…ê°€}</td>
                    <td>${stock.relative_strength.toFixed(2)}</td>
                    <td>${increaseRate}</td>
                    <td>${decreaseRate}</td>
                    <td>${stock.ì„¹í„°}</td>
                    <td>${stock["ì„¹í„° ìˆ˜ìµë¥  ìˆœìœ„"]}</td>
                    <td>${stock.ì‹œê°€ì´ì•¡}</td>
                </tr>`;
            });
            tbody.innerHTML = html;
        }

        function updatePagination() {
            const paginationDiv = document.getElementById("pagination");
            paginationDiv.innerHTML = "";

            paginationDiv.innerHTML += `<button onclick="changePage(${currentPage - 1})" ${currentPage === 1 ? "disabled" : ""}>ì´ì „</button>`;

            for (let i = 1; i <= totalPages; i++) {
                paginationDiv.innerHTML += `<button onclick="changePage(${i})" ${i === currentPage ? "disabled" : ""}>${i}</button>`;
            }

            paginationDiv.innerHTML += `<button onclick="changePage(${currentPage + 1})" ${currentPage === totalPages ? "disabled" : ""}>ë‹¤ìŒ</button>`;
        }

        function changePage(page) {
            if (page >= 1 && page <= totalPages) {
                currentPage = page;
                updateTable(getCurrentPageData());
                updatePagination();
                window.scrollTo({ top: 0, behavior: "smooth" });
            }
        }

        function filterTable() {
            const searchTerm = document.getElementById("searchInput").value.trim().toLowerCase();
            filteredStocks = allStocks.filter(stock => stock.ì´ë¦„.toLowerCase().includes(searchTerm));
            totalPages = Math.ceil(filteredStocks.length / limit);
            currentPage = 1;
            updateTable(getCurrentPageData());
            updatePagination();
        }

        document.getElementById("searchInput").addEventListener("keypress", function(event) {
            if (event.key === "Enter") {
                filterTable();
            }
        });
        fetchAllStocks();
    </script>

</body>
</html>
